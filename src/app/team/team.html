<!-- Team Section -->
<div class="section d-flex flex-column" style="height: 100%;">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h3 class="team-title"><b>MY TEAM</b></h3>
  </div>
  <div class="team-underline"></div>

  <!-- Only one separator -->
  <div class="coral-separator mb-4"></div>

  <!-- Two tables stacked vertically -->
  <div class="flex-fill d-flex flex-column" style="min-height: 600px;">

    <!-- Current Team Table -->
    <div class="flex-fill d-flex flex-column position-relative" style="flex: 1;">
      <h5 class="fw-bold mb-2 text-center">Current Team Members</h5>
      <div class="table-container flex-fill">
        <table class="table table-hover">
          <thead class="table-dark">
            <tr>
              <th>Full Name</th>
              <th>Email</th>
              <th>Employee ID</th>
              <th>Department</th>
              <th>Job Title</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr (click)="openAllocationModal()">
              <td>Jane Smith</td>
              <td>jane@example.com</td>
              <td>EMP1002</td>
              <td>Finance</td>
              <td>Accountant</td>
              <td><span class="badge bg-success">Completed</span></td>
            </tr>
            <tr (click)="openAllocationModal()">
              <td>Charlie Branth</td>
              <td>cbranth@example.com</td>
              <td>EMP1003</td>
              <td>Production</td>
              <td>Customer Care Agent</td>
              <td><span class="badge bg-warning">Pending</span></td>
            </tr>
            <tr (click)="openAllocationModal()">
              <td>Robert Brown</td>
              <td>robert@example.com</td>
              <td>EMP1004</td>
              <td>Engineering</td>
              <td>Developer</td>
              <td><span class="badge bg-danger">Overdue</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Floating circle controls -->
      <div class="fab-container">
        <button class="btn fab-btn btn-outline-primary" disabled>
          <i class="bi bi-plus-lg"></i>
        </button>
        <button class="btn fab-btn btn-outline-secondary" disabled>
          <i class="bi bi-save"></i>
        </button>
      </div>
    </div>

    <!-- Separator between tables -->
    <div class="coral-separator my-3"></div>

    <!-- Pending Approvals -->
    <div class="flex-fill d-flex flex-column position-relative" style="flex: 1;">
      <h5 class="fw-bold mb-2 text-center">Pending Approvals</h5>
      <div class="table-container flex-fill">
        <table class="table table-hover">
          <thead class="table-dark">
            <tr>
              <th>Full Name</th>
              <th>Email</th>
              <th>Employee ID</th>
              <th>Department</th>
              <th>Job Title</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let employee of pendingEmployees"
                (click)="togglePendingSelection(employee)"
                [ngClass]="{'selected-row': selectedPending.includes(employee)}">
              <td>{{ employee.name }}</td>
              <td>{{ employee.email }}</td>
              <td>{{ employee.id }}</td>
              <td>{{ employee.department }}</td>
              <td>{{ employee.title }}</td>
              <td><span class="badge bg-secondary">Pending To Be Approved</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Floating approve button -->
      <div class="fab-container">
        <button class="btn fab-btn btn-outline-success" [disabled]="selectedPending.length === 0">
          <i class="bi bi-check-lg"></i>
        </button>
      </div>
    </div>

  </div>
</div>

<!-- Allocation Modal -->
<div class="modal fade" id="allocationModal" tabindex="-1" aria-labelledby="allocationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header justify-content-center">
        <h5 class="modal-title text-center fw-bold" id="allocationModalLabel">Allocation</h5>
        <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body row">
        <!-- Clients Table (Left) -->
        <div class="col-md-4 d-flex flex-column">
          <h6 class="text-center"><b>Clients</b></h6>
          <div class="blue-separator"></div>
          <div class="table-container">
            <table class="table table-hover text-center">
              <thead class="table-dark">
                <tr><th>Client</th></tr>
              </thead>
              <tbody>
                <tr *ngFor="let client of clients"
                    (click)="selectClient(client)"
                    [ngClass]="{'selected-client': selectedClient === client}">
                  <td>{{ client }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Coral separator -->
        <div class="col-md-1 d-flex align-items-center justify-content-center">
          <div class="coral-separator-vertical"></div>
        </div>

        <!-- Buttons (Middle) -->
        <div class="col-md-2 d-flex flex-column justify-content-center align-items-center gap-3">
          <button class="btn btn-custom" (click)="openAllocationInput()" [disabled]="!selectedClient">&gt;</button>
          <button class="btn btn-custom" (click)="removeAllocation()" [disabled]="!selectedAllocation">&lt;</button>
        </div>

        <!-- Coral separator -->
        <div class="col-md-1 d-flex align-items-center justify-content-center">
          <div class="coral-separator-vertical"></div>
        </div>

        <!-- Allocations Table (Right) -->
        <div class="col-md-4 d-flex flex-column">
          <h6 class="text-center"><b>Allocations</b></h6>
          <div class="blue-separator"></div>
          <div class="table-container">
            <table class="table text-center">
              <thead class="table-dark">
                <tr><th>Client</th><th>%</th></tr>
              </thead>
              <tbody>
                <tr *ngFor="let allocation of allocations"
                    (click)="selectAllocation(allocation)"
                    [ngClass]="{'selected-client': selectedAllocation === allocation}">
                  <td>{{ allocation.client }}</td>
                  <td>{{ allocation.percent }}%</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Total Allocated -->
          <div class="mt-3 text-center">
            <label class="fw-bold me-2">Total Allocated:</label>
            <input type="text"
                   class="form-control d-inline-block w-auto text-center"
                   [ngClass]="{'bg-warning text-dark': totalAllocated < 100, 'bg-success text-white': totalAllocated === 100}"
                   [value]="totalAllocated + '%'"
                   disabled>
          </div>
        </div>
      </div>

      <div class="modal-footer justify-content-center">
        <button class="btn btn-outline-coral me-2" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-outline-navy" [disabled]="totalAllocated < 100">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Allocation Input Modal -->
<div class="modal fade" id="allocationInputModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header justify-content-center">
        <h5 class="modal-title text-center fw-bold">{{ selectedClient }}</h5>
        <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="modal"></button>
      </div>
      <div class="blue-separator"></div>
      <div class="modal-body">
        <label class="form-label">Allocation %</label>
        <input type="number" class="form-control" [(ngModel)]="allocationPercent" placeholder="Enter %">
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-outline-coral me-2" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-outline-navy" (click)="saveAllocation()" data-bs-dismiss="modal">Save</button>
      </div>
    </div>
  </div>
</div>
